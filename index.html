<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cronograma Informática Educativa 2026</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            --indigo-soft: #eef2ff;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }

        .hero-banner {
            background: var(--primary-gradient);
            border-radius: 2rem;
            padding: 3rem 2rem;
            color: white;
            text-align: center;
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2);
            margin-bottom: 2rem;
            border-bottom: 6px solid #4f46e5;
        }

        .navbar-custom {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .activity-card {
            background: white;
            border-radius: 1.2rem;
            border: 1px solid #e2e8f0;
            padding: 1.5rem;
            height: 100%;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }

        .month-badge {
            font-size: 0.7rem;
            font-weight: 900;
            text-transform: uppercase;
            color: #6366f1;
            background: var(--indigo-soft);
            padding: 0.3rem 0.8rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            width: fit-content;
        }

        .icon-box {
            width: 44px;
            height: 44px;
            background: #f1f5f9;
            border-radius: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            margin-bottom: 1rem;
        }

        .filter-pill {
            cursor: pointer;
            border-radius: 50px;
            padding: 0.5rem 1.2rem;
            font-weight: 700;
            font-size: 0.85rem;
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
            background: white;
            color: #64748b;
            white-space: nowrap;
        }

        .filter-pill.active {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        #loadingState {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5rem 0;
        }

        @media print {
            .no-print { display: none !important; }
            .activity-card { break-inside: avoid; border: 1px solid #ddd !important; shadow: none !important; }
            body { background: white; }
        }
    </style>
</head>
<body>

    <nav class="navbar-custom no-print">
        <div class="container d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center gap-2">
                <div class="bg-primary p-2 rounded-3 text-white">
                    <i class="bi bi-calendar-check-fill"></i>
                </div>
                <span class="fw-black text-uppercase tracking-tight">Cronograma 2026</span>
            </div>
            <div class="d-flex gap-2">
                <button class="btn btn-light rounded-pill border shadow-sm" onclick="fetchData()">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>
                <button class="btn btn-dark rounded-pill px-4 fw-bold shadow-sm" onclick="window.print()">
                    <i class="bi bi-printer me-2"></i> Reporte
                </button>
            </div>
        </div>
    </nav>

    <div class="container py-4">
        <header class="hero-banner">
            <h1 class="fw-black">Cronograma Informática Educativa 2026</h1>
            <p class="opacity-75 fw-bold">Enero-Junio 2026</p>
        </header>

        <!-- Filtros -->
        <div class="no-print mb-4 overflow-auto py-2 d-flex gap-2 align-items-center" id="filtersContainer">
            <i class="bi bi-filter text-muted me-2"></i>
            <!-- Se llenará dinámicamente -->
        </div>

        <div id="loadingState">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-3 text-muted fw-bold">Sincronizando con Google Sheets...</p>
        </div>

        <div id="errorState" class="alert alert-danger rounded-4 p-4 shadow-sm" style="display: none;">
            <div class="d-flex align-items-center">
                <i class="bi bi-exclamation-octagon-fill fs-3 me-3"></i>
                <div>
                    <h6 class="fw-bold mb-1">Error de Sincronización</h6>
                    <p class="mb-0 small" id="errorMsg"></p>
                </div>
            </div>
        </div>

        <div class="row g-4" id="cardsGrid">
            <!-- Se llenará dinámicamente -->
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbzhmC7bDVVMIpKYK6g2LZZdvK7fVqfC08PDf3cLisTm2_9z4Wd5RGgceTTZdg2Vp_jP/exec";
        let todasLasActividades = [];
        let mesActual = 'Todos';

        async function fetchData() {
            const loading = document.getElementById('loadingState');
            const error = document.getElementById('errorState');
            const grid = document.getElementById('cardsGrid');

            loading.style.display = 'flex';
            error.style.display = 'none';
            grid.innerHTML = '';

            try {
                const response = await fetch(API_URL, {
                    method: 'GET',
                    redirect: 'follow'
                });

                if (!response.ok) throw new Error("No se pudo conectar con la API de Google.");

                const data = await response.json();
                
                todasLasActividades = data.map(item => ({
                    mes: item.Mes || item.mes || 'Sin Mes',
                    fecha: item.Fecha || item.fecha || 'TBD',
                    actividad: item.Actividad || item.actividad || 'Sin título',
                    icono: item.Icono || item.icono || 'bi-calendar-event',
                    color: item.Color || item.color || 'text-primary'
                })).filter(a => a.actividad !== 'Sin título' && a.actividad !== 'Actividad'); // Filtramos encabezados si se cuelan

                renderFilters();
                renderCards();

            } catch (err) {
                console.error(err);
                document.getElementById('errorMsg').innerText = err.message;
                error.style.display = 'block';
            } finally {
                loading.style.display = 'none';
            }
        }

        function renderFilters() {
            const container = document.getElementById('filtersContainer');
            // Ordenamos los meses para que aparezcan en orden cronológico
            const ordenMeses = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            
            const mesesPresentes = [...new Set(todasLasActividades.map(a => a.mes))];
            mesesPresentes.sort((a, b) => ordenMeses.indexOf(a) - ordenMeses.indexOf(b));
            
            const meses = ['Todos', ...mesesPresentes];
            
            container.innerHTML = `<i class="bi bi-filter text-muted me-2"></i>` + meses.map(m => `
                <div class="filter-pill ${m === mesActual ? 'active' : ''}" onclick="filterBy('${m}')">
                    ${m}
                </div>
            `).join('');
        }

        window.filterBy = (mes) => {
            mesActual = mes;
            renderFilters();
            renderCards();
        };

        function renderCards() {
            const grid = document.getElementById('cardsGrid');
            const filtradas = mesActual === 'Todos' 
                ? todasLasActividades 
                : todasLasActividades.filter(a => a.mes === mesActual);

            if (filtradas.length === 0) {
                grid.innerHTML = `<div class="col-12 text-center py-5 text-muted">No se encontraron actividades.</div>`;
                return;
            }

            grid.innerHTML = filtradas.map(act => `
                <div class="col-md-6 col-lg-4">
                    <div class="activity-card">
                        <span class="month-badge">${act.mes}</span>
                        <div class="icon-box ${mapColor(act.color)}">
                            <i class="bi ${mapIcon(act.icono)}"></i>
                        </div>
                        <h6 class="fw-bold mb-3 lh-sm">${act.actividad}</h6>
                        <div class="mt-auto pt-3 border-top d-flex align-items-center text-muted small fw-bold">
                            <i class="bi bi-clock-history me-2 text-primary"></i> ${act.fecha}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Mapea el color para asegurar que se use la clase correcta de Bootstrap
        function mapColor(colorInput) {
            if (!colorInput) return 'text-primary';
            // Si ya viene como clase 'text-danger', la usamos. Si viene como 'danger', le agregamos el prefijo.
            return colorInput.startsWith('text-') ? colorInput : `text-${colorInput}`;
        }

        // Mapea nombres simples o usa la clase directa de Bootstrap Icons
        function mapIcon(iconName) {
            if (!iconName) return 'bi-calendar-event';
            
            const map = {
                'Rocket': 'bi-rocket-takeoff-fill',
                'Award': 'bi-award-fill',
                'Cpu': 'bi-cpu',
                'Users': 'bi-people-fill',
                'Globe': 'bi-globe-americas',
                'Star': 'bi-star-fill',
                'Cap': 'bi-mortarboard-fill',
                'Map': 'bi-map-fill',
                'Shield': 'bi-shield-check',
                'Trophy': 'bi-trophy-fill',
                'Calendar': 'bi-calendar-event'
            };

            // Si el nombre en la hoja es un alias del mapa, lo usamos; si no, asumimos que es una clase bi- directa
            return map[iconName] || (iconName.startsWith('bi-') ? iconName : 'bi-calendar-event');
        }

        // Iniciar carga
        document.addEventListener('DOMContentLoaded', fetchData);
    </script>
</body>
</html>